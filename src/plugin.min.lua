local a=1;local b=21496;local c,d,e,f,g,h;local i=game:GetService("UserInputService")local j=game:GetService("HttpService")local k=game:GetService("CoreGui")local l={}local m={}local n=j:GenerateGUID()local o=false;local p=0;local q;q=function(...)return print("[RSync build "..tostring(a).."] ",...)end;local r;r=function(...)q(...)g=tick()local s=""local t={...}for u=1,#t do local v=t[u]s=s..v.." "end;s=s:sub(1,#s-1)f.Text=s;f.Visible=true;local w=g;return Spawn(function()wait(5)if w==g then f.Visible=false end end)end;c=function(x)return x.Changed:connect(function(y)if y=="Source"then if m[x]==x.Source then m[x]=nil else return d(x,false)end end end)end;d=function(x,z)if z==nil then z=true end;local A={}local B=x.Parent;while B~=game do table.insert(A,1,B)B=B.Parent end;local C=""for u=1,#A do local D=A[u]C=C..D.Name.."/"end;if not l[x]then l[x]=j:GenerateGUID(false)l[l[x]]=x;c(x)end;local E={path=C,name=x.Name,source=x.Source,class=x.ClassName,place_name=n,guid=l[x]}return pcall(function()return j:PostAsync("http://localhost:"..tostring(b).."/write/"..tostring(z and'open'or'update'),j:JSONEncode(E),"ApplicationJson",false)end)end;h=function()o=false;l={}m={}n=j:GenerateGUID()return q("Resetting, if you restart the client you will need to reopen your scripts again, the files on disk will no longer be sent to this game instance as a result of the connection loss.")end;local F;F=function()if o then return end;o=true;return Spawn(function()while true do local G=pcall(function()local H=j:GetAsync("http://localhost:"..tostring(b).."/poll",true)local I=j:JSONDecode(H)if I.type=="update"then if l[I.data.guid]then m[l[I.data.guid]]=I.data.source;l[I.data.guid].Source=I.data.source end end end)if not G then p=p+1 end;if G then p=0 end;if p>3 then h()r("Lost connection to the helper client, stopping.")break end end end)end;local J;J=function()local G,K=pcall(function()local E=j:JSONDecode(j:GetAsync("http://localhost:"..tostring(b).."/",true))if E.status=="OK"then if E.build==a then F()return e()else return r("Plugin version does not match helper version, restart studio.")end else r("Unhandled error, please check output.")return q(E.error)end end)if not G then if K:find("Http requests are not enabled")then return r("Set HttpService.HttpEnabled to true to use this feature.")elseif K:find("Couldn't connect to server")then return r("Couldn't connect to helper client, did you start the executable?")else r("Unhandled error, please check output.")return q("An error occurred: "..tostring(K))end end end;e=function()if not o then return J()end;local L=game.Selection:Get()if#L==0 then return r("Select one or more scripts in the Explorer.")end;for u=1,#L do local M=L[u]if M:IsA("LuaSourceContainer")then d(M)end end end;do f=Instance.new("TextLabel")f.Parent=Instance.new("ScreenGui",k)f.Name="RSync Alert"f.BackgroundColor3=Color3.new(1,1,1)f.BackgroundTransparency=0.3;f.BorderColor3=Color3.new(1,1,1)f.BorderSizePixel=30;f.Position=UDim2.new(0.5,-150,0.5,-25)f.Size=UDim2.new(0,300,0,50)f.ZIndex=10;f.Font="SourceSansLight"f.FontSize="Size24"f.Visible=false;f.TextWrapped=true end;local N=plugin:CreateToolbar("RSync")local O=N:CreateButton("Open with Editor","Open with system .lua editor (Ctrl+B)","rbxassetid://478150446")O.Click:connect(e)return i.InputBegan:connect(function(P,Q)if Q then return end;if P.KeyCode==Enum.KeyCode.B and i:IsKeyDown(Enum.KeyCode.LeftControl)then return e()end end)
